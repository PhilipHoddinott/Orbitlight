<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Orbit's Light</title>
  <link rel="stylesheet" href="css/styles.css">
  <!-- SGP4 orbital mechanics library -->
  <script src="https://unpkg.com/satellite.js@5.0.0/dist/satellite.min.js"></script>
  <!-- Modular app scripts - loaded but not executed until DOM is ready -->
  <script src="js/cities.js"></script>
  <script src="js/config.js"></script>
  <script src="js/math.js"></script>
  <script src="js/tle.js"></script>
  <script src="js/orbital.js"></script>
  <script src="js/render.js"></script>
  <script src="js/ui.js"></script>
  <script src="js/colors.js"></script>
  <!-- Main entry point: waits for DOM ready -->
  <script src="js/main.js"></script>
</head>
<body>
  <header>
    <div class="row">
  <h1>Orbit's Light — See the Satellites Overhead</h1>
  <span class="tag"><span id="tlePill" class="mono">—</span></span>
    </div>
    <div id="topControls" style="display:flex; flex-direction:column; gap:10px; align-items:flex-start; width:100%; max-width:420px;">
      <div style="font-size:12px; color:var(--muted); cursor:pointer; margin-bottom:2px;" id="helpLink">first time? <span style="color:var(--accent); text-decoration:underline;">Click here</span></div>
      <div class="row" style="gap: 8px; margin-bottom: 0;">
        <span id="locPill" class="pill">Locating…</span>
        <span id="clockPill" class="pill">—</span>
      </div>
      <div id="manualLocWrap" style="display:flex; flex-direction:column; gap:8px; width:100%; margin-top:8px;">
        <input id="manualLoc" placeholder="lat, lon (e.g. 42.36,-71.06)" style="padding:6px 8px; font-size:13px; width:100%; max-width:320px; margin-bottom:4px;" />
        <div style="display:flex; gap:8px; width:100%;">
          <button id="applyLocBtn" style="padding:6px 10px; flex:1;">Set Location</button>
          <button id="resetLocBtn" style="padding:6px 10px; flex:1;">Reset to My Location</button>
        </div>
      </div>
    </div>
  </header>
  <div style="padding:6px 20px; color:var(--muted); font-size:13px;">By Philip Hoddinott</div>

  <main>
    <section class="card" id="left">
      <div class="row" style="justify-content: space-between; margin-bottom: 10px;">
        <div class="row">
          <label for="elevCut">Elevation cutoff:</label>
          <input id="elevCut" type="number" min="0" max="90" step="1" value="15" style="width: 80px;" />
          <label>deg</label>
          <span style="width:16px;"></span>
          <label for="altCut">Max altitude:</label>
          <input id="altCut" type="number" min="0" step="50" value="500" style="width: 100px;" />
          <label>km</label>
        </div>
        <div class="row">
          <button class="primary" id="refreshBtn">Refresh now</button>
          <button id="toggleBtn">Pause</button>
          <label for="sortSelect" style="font-size:12px;color:var(--muted);">Sort:</label>
          <select id="sortSelect" style="padding:6px 8px; font-size:13px;">
            <option value="name">Name</option>
            <option value="altitude">Altitude</option>
            <option value="distance">Distance</option>
            <option value="speed">Speed</option>
          </select>
          <button id="colorizeBtn" title="Colorize by selected sort">Colorize: Off</button>
          <button id="namesBtn" title="Toggle all names">Names: Off</button>
          <button id="nightBtn" title="Toggle red night mode">Night: Off</button>
        </div>
      </div>

      <div id="plotWrap">
        <canvas id="plot"></canvas>
        <div class="legend">
          <span><span class="dot" style="background: var(--accent);"></span> Visible now (el ≥ cutoff)</span>
          <div id="colorLegend" style="display:none; align-items:center; gap:8px; margin-left:12px;">
            <div style="display:flex; align-items:center; gap:8px;">
              <span id="colorMin" style="font-size:12px;color:var(--muted);">—</span>
              <div id="colorBar" style="width:160px; height:10px; border-radius:6px; background:linear-gradient(90deg,#79b8ff,#ff6b6b);"></div>
              <span id="colorMax" style="font-size:12px;color:var(--muted);">—</span>
            </div>
          </div>
            </div>
            </div>
      </div>
    </section>

        <!-- vertical legend used on wider screens (center between columns) -->
        <div id="colorLegendVert" style="display:none; align-items:center; gap:8px;">
          <div id="colorMaxVert" style="font-size:12px; color:var(--muted)">—</div>
          <div id="colorBarVert" style="width:14px; height:220px; border-radius:8px;"></div>
          <div id="colorMinVert" style="font-size:12px; color:var(--muted)">—</div>
        </div>

    <aside class="card" id="right">
      <div class="row" style="justify-content: space-between; margin-bottom: 10px;">
        <div>
          <div style="font-size: 16px; font-weight: 600;">Satellites Above Horizon</div>
          <div class="meta" style="color: var(--muted); font-size: 12px;">From <span id="siteLabel">—</span></div>
        </div>
        <div class="row">
          <label for="filterText">Filter</label>
          <input id="filterText" placeholder="e.g. VANGUARD" />
        </div>
      </div>
      <div id="counts" class="meta" style="margin-bottom: 8px; color: var(--muted);"></div>
      <div id="satList" class="satList"></div>
    </aside>
  </main>

  <script src="js/app.js"></script>
  <div id="redOverlay"></div>
  <footer style="padding: 12px 20px; text-align: center; font-size: 11px; color: var(--muted);">
    As always, written while sitting next to my beautiful (sleeping) wife. ❤️
  </footer>

  <!-- Help Modal -->
  <div id="helpModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); z-index:100; overflow:auto; padding:20px;">
    <div style="background:var(--panel); border:1px solid #1b2648; border-radius:14px; max-width:800px; margin:40px auto; padding:30px; color:var(--text);">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <h2 style="margin:0; font-size:24px;">Orbit's Light — Getting Started</h2>
        <button id="helpClose" style="background:none; border:none; color:var(--text); font-size:24px; cursor:pointer; padding:0; width:30px; height:30px;">×</button>
      </div>
      
      <div style="line-height:1.6; font-size:14px; color:var(--muted);">
        <h3 style="color:var(--accent); margin-top:20px; margin-bottom:10px;">What this does</h3>
        <p>Orbit's Light shows satellites passing overhead from your location using SGP4 orbital propagation. Each dot on the polar plot represents a satellite; you can filter, sort, and colorize them to analyze orbital patterns.</p>

        <h3 style="color:var(--accent); margin-top:20px; margin-bottom:10px;">The sky plot (left)</h3>
        <ul style="margin:10px 0; padding-left:20px;">
          <li><strong>Polar Grid:</strong> North at top, South at bottom. Concentric rings show elevation angles (0°=horizon, 90°=directly overhead).</li>
          <li><strong>Cardinal Directions:</strong> N, E, S, W labels mark compass directions.</li>
          <li><strong>Blue Dots:</strong> Visible satellites above your elevation cutoff.</li>
          <li><strong>Colored Rings:</strong> Accent-colored ring shows your minimum elevation cutoff.</li>
          <li><strong>Names Toggle:</strong> Click "Names: Off/On" to show satellite names and speeds on the plot.</li>
        </ul>

        <h3 style="color:var(--accent); margin-top:20px; margin-bottom:10px;">⚙️ Filters & Controls (Top Controls)</h3>
        <ul style="margin:10px 0; padding-left:20px;">
          <li><strong>Elevation Cutoff:</strong> Hides satellites below this angle (default 15°). Lower = more satellites but shorter observation windows.</li>
          <li><strong>Max Altitude:</strong> Hides satellites higher than this (default 500 km). Useful for filtering out high-orbit sats.</li>
          <li><strong>Refresh Now:</strong> Forces a TLE (orbit data) reload from server.</li>
          <li><strong>Pause:</strong> Stops the animation to examine static positions.</li>
          <li><strong>Sort:</strong> Organize satellite list by Name, Altitude, Distance (closest first), or Speed (fastest first).</li>
          <li><strong>Colorize:</strong> Color satellites and list names by the selected sort metric (helpful for visual pattern spotting).</li>
          <li><strong>Names:</strong> Toggle all satellite names on the sky plot.</li>
          <li><strong>Night:</strong> Toggle red night-vision mode to preserve dark adaptation.</li>
        </ul>

        <h3 style="color:var(--accent); margin-top:20px; margin-bottom:10px;">Satellite list (right)</h3>
        <ul style="margin:10px 0; padding-left:20px;">
          <li><strong>Click to Select:</strong> Tap any satellite to highlight it on the plot.</li>
          <li><strong>Filter Box:</strong> Type a name to quickly find satellites (e.g., "ISS", "HUBBLE").</li>
          <li><strong>Per-Satellite Info:</strong> Azimuth (direction), Elevation (angle), Altitude (km), Range (distance in km), Speed (angular speed in °/s).</li>
        </ul>

        <h3 style="color:var(--accent); margin-top:20px; margin-bottom:10px;">Observer location</h3>
        <p>Shows your latitude/longitude and the nearest major city with distance and bearing. Location is detected via device GPS; you can also enter a manual latitude,longitude in the box below the location display to set a custom observer location.</p>

        <p style="margin-top:8px;"><strong>Orientation note:</strong> The sky plot is displayed as if you were lying down with your head to the north and feet to the south — east appears on the left and west on the right.</p>

        <h3 style="color:var(--accent); margin-top:20px; margin-bottom:10px;">Time display</h3>
        <p>Displays your local time and how long ago the TLE (orbit data) was last updated. Fresher TLEs improve prediction accuracy.</p>

        <h3 style="color:var(--accent); margin-top:20px; margin-bottom:10px;">Color legend</h3>
        <p>When Colorize is on, a color scale appears showing which metric is currently mapped. On phones, the legend is horizontal below the plot. On desktop, it's centered between columns.</p>

        <h3 style="color:var(--accent); margin-top:20px; margin-bottom:10px;">Tips</h3>
        <ul style="margin:10px 0; padding-left:20px;">
          <li>Lower your elevation cutoff for more satellites (but shorter visibility windows).</li>
          <li>Use "Colorize" with "Sort: Altitude" to see which satellites are highest.</li>
          <li>Watch the speed of dots moving on the plot—slower = higher orbits, faster = lower orbits.</li>
          <li>Use Night mode when observing to keep your eyes dark-adapted.</li>
          <li>The ISS (International Space Station) is often the brightest and fastest-moving at lower altitudes.</li>
        </ul>

        <h3 style="color:var(--accent); margin-top:20px; margin-bottom:10px;">Technical notes</h3>
        <p>Data from CelesTrak TLE updates. Predictions use SGP4 orbital propagation (accurate for about one week from TLE date). Light pollution context is provided via nearest major city bearing/distance.</p>
      </div>

      <button id="helpCloseBtn" style="background:var(--accent); color:var(--bg); border:none; border-radius:8px; padding:10px 20px; font-weight:600; cursor:pointer; margin-top:20px; width:100%;">Got It, Let's Watch Satellites!</button>
    </div>
  </div>
</body>
</html>
